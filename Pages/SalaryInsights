import React, { useState } from 'react';
import { InvokeLLM } from '@/integrations/Core';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { DollarSign, TrendingUp, MapPin, Briefcase, Loader2 } from 'lucide-react';
import { motion } from 'framer-motion';

export default function SalaryInsightsPage() {
  const [formData, setFormData] = useState({
    jobTitle: '',
    location: '',
    experience: '',
    skills: ''
  });
  const [salaryData, setSalaryData] = useState(null);
  const [isLoading, setIsLoading] = useState(false);

  const getSalaryInsights = async () => {
    if (!formData.jobTitle.trim()) return;

    setIsLoading(true);
    try {
      const result = await InvokeLLM({
        prompt: `Provide comprehensive salary insights for a ${formData.jobTitle} position with the following details:
        - Location: ${formData.location || 'Not specified'}
        - Experience Level: ${formData.experience || 'Not specified'}
        - Key Skills: ${formData.skills || 'Not specified'}

        Include:
        1. Salary ranges (min, average, max)
        2. Factors affecting salary
        3. Regional comparisons
        4. Industry trends
        5. Negotiation tips
        6. Career growth projections

        Use current market data and be realistic about ranges.`,
        response_json_schema: {
          type: "object",
          properties: {
            salary_range: {
              type: "object",
              properties: {
                min: { type: "number" },
                average: { type: "number" },
                max: { type: "number" },
                currency: { type: "string" }
              }
            },
            factors_affecting_salary: {
              type: "array",
              items: { type: "string" }
            },
            regional_comparison: {
              type: "array",
              items: {
                type: "object",
                properties: {
                  location: { type: "string" },
                  average_salary: { type: "number" }
                }
              }
            },
            industry_trends: { type: "string" },
            negotiation_tips: {
              type: "array", 
              items: { type: "string" }
            },
            growth_projection: { type: "string" }
          }
        }
      });

      setSalaryData(result);
    } catch (error) {
      console.error("Failed to get salary insights:", error);
    } finally {
      setIsLoading(false);
    }
  };

  const handleInputChange = (field, value) => {
    setFormData(prev => ({ ...prev, [field]: value }));
  };

  return (
    <div className="min-h-screen p-4 md:p-8">
      <div className="max-w-6xl mx-auto">
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          className="text-center mb-8"
        >
          <div className="w-16 h-16 bg-gradient-to-br from-green-500 to-emerald-600 rounded-2xl flex items-center justify-center mx-auto mb-4">
            <DollarSign className="w-8 h-8 text-white" />
          </div>
          <h1 className="text-3xl font-bold text-slate-800">Salary Insights</h1>
          <p className="text-slate-600 mt-2">Get data-driven salary information for any role</p>
        </motion.div>

        {!salaryData ? (
          <Card className="max-w-2xl mx-auto">
            <CardHeader>
              <CardTitle>Get Salary Insights</CardTitle>
            </CardHeader>
            <CardContent className="space-y-4">
              <div className="space-y-2">
                <Label htmlFor="jobTitle">Job Title</Label>
                <Input
                  id="jobTitle"
                  placeholder="e.g. Software Engineer, Data Scientist"
                  value={formData.jobTitle}
                  onChange={(e) => handleInputChange('jobTitle', e.target.value)}
                />
              </div>
              
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div className="space-y-2">
                  <Label htmlFor="location">Location</Label>
                  <Input
                    id="location"
                    placeholder="e.g. San Francisco, CA"
                    value={formData.location}
                    onChange={(e) => handleInputChange('location', e.target.value)}
                  />
                </div>
                <div className="space-y-2">
                  <Label htmlFor="experience">Experience Level</Label>
                  <Select 
                    value={formData.experience}
                    onValueChange={(value) => handleInputChange('experience', value)}
                  >
                    <SelectTrigger>
                      <SelectValue placeholder="Select level" />
                    </SelectTrigger>
                    <SelectContent>
                      <SelectItem value="Entry">Entry Level (0-2 years)</SelectItem>
                      <SelectItem value="Mid">Mid Level (3-5 years)</SelectItem>
                      <SelectItem value="Senior">Senior Level (6-10 years)</SelectItem>
                      <SelectItem value="Lead">Lead/Principal (10+ years)</SelectItem>
                    </SelectContent>
                  </Select>
                </div>
              </div>

              <div className="space-y-2">
                <Label htmlFor="skills">Key Skills (optional)</Label>
                <Input
                  id="skills"
                  placeholder="e.g. Python, React, AWS, Machine Learning"
                  value={formData.skills}
                  onChange={(e) => handleInputChange('skills', e.target.value)}
                />
              </div>

              <Button
                onClick={getSalaryInsights}
                disabled={isLoading || !formData.jobTitle.trim()}
                className="w-full"
              >
                {isLoading ? (
                  <>
                    <Loader2 className="w-4 h-4 mr-2 animate-spin" />
                    Analyzing Market Data...
                  </>
                ) : (
                  <>
                    <DollarSign className="w-4 h-4 mr-2" />
                    Get Salary Insights
                  </>
                )}
              </Button>
            </CardContent>
          </Card>
        ) : (
          <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
            {/* Salary Range */}
            <Card className="lg:col-span-2">
              <CardHeader>
                <CardTitle className="flex items-center gap-2">
                  <DollarSign className="w-5 h-5 text-green-600" />
                  Salary Range for {formData.jobTitle}
                </CardTitle>
              </CardHeader>
              <CardContent>
                <div className="grid grid-cols-3 gap-4 mb-6">
                  <div className="text-center p-4 bg-red-50 rounded-lg">
                    <div className="text-2xl font-bold text-red-600">
                      ${salaryData.salary_range?.min?.toLocaleString()}
                    </div>
                    <div className="text-sm text-slate-600">Minimum</div>
                  </div>
                  <div className="text-center p-4 bg-green-50 rounded-lg">
                    <div className="text-2xl font-bold text-green-600">
                      ${salaryData.salary_range?.average?.toLocaleString()}
                    </div>
                    <div className="text-sm text-slate-600">Average</div>
                  </div>
                  <div className="text-center p-4 bg-blue-50 rounded-lg">
                    <div className="text-2xl font-bold text-blue-600">
                      ${salaryData.salary_range?.max?.toLocaleString()}
                    </div>
                    <div className="text-sm text-slate-600">Maximum</div>
                  </div>
                </div>

                <div className="space-y-4">
                  <div>
                    <h4 className="font-semibold mb-2">Factors Affecting Salary:</h4>
                    <ul className="space-y-1">
                      {salaryData.factors_affecting_salary?.map((factor, index) => (
                        <li key={index} className="flex items-start gap-2">
                          <div className="w-1.5 h-1.5 bg-blue-500 rounded-full mt-2" />
                          <span className="text-sm text-slate-700">{factor}</span>
                        </li>
                      ))}
                    </ul>
                  </div>

                  <div>
                    <h4 className="font-semibold mb-2">Industry Trends:</h4>
                    <p className="text-sm text-slate-700">{salaryData.industry_trends}</p>
                  </div>
                </div>
              </CardContent>
            </Card>

            {/* Regional Comparison */}
            <Card>
              <CardHeader>
                <CardTitle className="flex items-center gap-2">
                  <MapPin className="w-5 h-5 text-blue-600" />
                  Regional Comparison
                </CardTitle>
              </CardHeader>
              <CardContent>
                <div className="space-y-3">
                  {salaryData.regional_comparison?.map((region, index) => (
                    <div key={index} className="flex justify-between items-center p-3 bg-slate-50 rounded-lg">
                      <span className="font-medium">{region.location}</span>
                      <span className="text-green-600 font-semibold">
                        ${region.average_salary?.toLocaleString()}
                      </span>
                    </div>
                  ))}
                </div>
              </CardContent>
            </Card>

            {/* Negotiation Tips */}
            <Card>
              <CardHeader>
                <CardTitle className="flex items-center gap-2">
                  <TrendingUp className="w-5 h-5 text-purple-600" />
                  Negotiation Tips
                </CardTitle>
              </CardHeader>
              <CardContent>
                <ul className="space-y-2">
                  {salaryData.negotiation_tips?.map((tip, index) => (
                    <li key={index} className="flex items-start gap-2">
                      <div className="w-1.5 h-1.5 bg-purple-500 rounded-full mt-2" />
                      <span className="text-sm text-slate-700">{tip}</span>
                    </li>
                  ))}
                </ul>
              </CardContent>
            </Card>

            {/* Growth Projection */}
            <Card>
              <CardHeader>
                <CardTitle className="flex items-center gap-2">
                  <Briefcase className="w-5 h-5 text-indigo-600" />
                  Career Growth
                </CardTitle>
              </CardHeader>
              <CardContent>
                <p className="text-sm text-slate-700">{salaryData.growth_projection}</p>
              </CardContent>
            </Card>

            <div className="lg:col-span-3">
              <Button
                onClick={() => {
                  setSalaryData(null);
                  setFormData({ jobTitle: '', location: '', experience: '', skills: '' });
                }}
                variant="outline"
                className="w-full"
              >
                Analyze Another Role
              </Button>
            </div>
          </div>
        )}
      </div>
    </div>
  );
}